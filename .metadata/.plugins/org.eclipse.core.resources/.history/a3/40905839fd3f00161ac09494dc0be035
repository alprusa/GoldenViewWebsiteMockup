var directionsDisplay;
var directionsService = new google.maps.DirectionsService();
var mapCenterPoint = new google.maps.LatLng(34.638650, -120.451350,17); //loaction of goldenView
var map;


function initialize() {
	directionsDisplay = new google.maps.DirectionsRenderer();

  	var mapProp = {
	    center:mapCenterPoint,
	    zoom:17,
	    mapTypeId:google.maps.MapTypeId.ROADMAP
	};
	
  	map = new google.maps.Map(document.getElementById("googleMap"),mapProp);
  	
  	var pinIcon = new google.maps.MarkerImage(
	    "../img/mapIcon.png",
	    null, /* size is determined at runtime */
	    null, /* origin is 0,0 */
	    null, /* anchor is bottom center of the scaled image */
	    new google.maps.Size(50, 50)
	);  

  	var marker=new google.maps.Marker({
	  position:mapCenterPoint,
	  //animation:google.maps.Animation.BOUNCE
	});
	
	marker.setAnimation(google.maps.Animation.BOUNCE);
    setTimeout(function(){ marker.setAnimation(null); }, 2250);
	
	marker.setMap(map);
	
	var infowindow = new google.maps.InfoWindow({
	  content:"Golden View Senior Services"
	});
	
	infowindow.open(map,marker);

	google.maps.event.addListener(map,'center_changed',function() {
	  window.setTimeout(function() {
	    map.panTo(marker.getPosition());
	  },3000);
	});
	
	directionsDisplay.setMap(map);
}

$('form').submit(function(e) {
    e.preventDefault();

    $.ajax({
    	url: "directions.txt",
        method: "POST",
        data: {
        	StreetAddress: $('#StreetAddress').val(),
        	City: $('#City').val(),
            State: $('#State').val(),
            Zipcode: $('#Zipcode').val()
        },
        dataType: "json"
    }).error(function(x, status, error){
    	console.log("Failed" + x , " " + status + " ", error);
    }). success(function(data, status) {
    	var lang = 41.850033;
    	var lat = -87.6500523;
		calcRoute(lang, lat);
    });
});

function calcRoute(lang, lat) {
  var selectedMode = "DRIVING";
  var request = {
      origin: "Los Angeles, Ca",
      destination: mapCenterPoint,
      // Note that Javascript allows us to access the constant
      // using square brackets and a string value as its
      // "property."
      travelMode: google.maps.TravelMode[selectedMode]
  };
  directionsService.route(request, function(response, status) {
    if (status == google.maps.DirectionsStatus.OK) {
      directionsDisplay.setDirections(response);
    }
  });

	/*google.maps.event.removeListener(map,'center_changed',function() {
	  window.setTimeout(function() {
	    map.panTo(marker.getPosition());
	  },3000);
	});*/
}

google.maps.event.addDomListener(window, 'load', initialize);